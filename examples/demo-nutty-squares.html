<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Verf | Demo Nutty Squares</title>
        <meta name="description" content="">
        <meta name="author" content="Quinten Clause">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="../styles.css" />
    </head>
    <body>
        <script type="module">
            import {VerfGame, Scene, GameObject, Keys, World, Body} from '../index.js';

            class TestScene extends Scene {
                init ()
                {
                    let world = this.addWorld(new World({gravityY: 512}));
                    world.setBounds(0, 0, 320, 240);
                    world.worldBoundsRestitution = 0;

                    this.keys = this.addControls(new Keys({wasd: false}));
                    // press r or y to restart
                    this.keys.on('yup', () => {
                        this.restart();
                    });

                    this.keysTwo = this.addControls(new Keys({cursors: false}));

                    let crate = this.add(new GameObject({x: 160, y: 192}));
                    crate.fillStyle = '#ff5e5b';
                    crate.width = 24;
                    crate.height = 24;
                    crate.addBody(new Body());
                    crate.body.immovable = false;
                    crate.body.collideWorldBounds = true;
                    crate.body.allowGravity = true;
                    crate.body.frictionX = 1;
                    crate.jumpTimer = 0;

                    this.crate = crate;

                    let player = this.add(new GameObject({x: 160, y: 160}));
                    player.fillStyle = '#639fab';
                    player.width = 24;
                    player.height = 24;
                    player.addBody(new Body());
                    player.body.immovable = false;
                    player.body.collideWorldBounds = true;
                    player.body.allowGravity = true;
                    player.body.frictionX = 1;
                    player.jumpTimer = 0;

                    this.player = player;

                    world.addCollider({
                        a: player,
                        b: crate
                    });

                    let platform = this.add(new GameObject({x: 40, y: 192}));
                    platform.fillStyle = '#fcfff7';
                    platform.width = 80;
                    platform.height = 24;
                    platform.addBody(new Body());

                    world.addCollider({
                        a: player,
                        b: platform
                    });

                    world.addCollider({
                        a: crate,
                        b: platform
                    });

                    platform = this.add(new GameObject({x: 220, y: 120}));
                    platform.fillStyle = '#fcfff7';
                    platform.width = 120;
                    platform.height = 20;
                    platform.addBody(new Body());

                    world.addCollider({
                        a: player,
                        b: platform
                    });

                    world.addCollider({
                        a: crate,
                        b: platform
                    });

                }

                update(time, delta)
                {
                    if (this.keys.left) {
                        this.crate.body.vx = -160;
                    } else if (this.keys.right){
                        this.crate.body.vx = 160;
                    } else {
                        this.crate.body.vx = 0;
                    }

                    if (this.keys.a && this.crate.jumpTimer < time && (this.crate.body.blocked.bottom || this.crate.body.touching.bottom)) {
                        this.crate.body.vy = -320;
                        this.crate.jumpTimer = time + 250;
                    }

                    if (this.keysTwo.left) {
                        this.player.body.vx = -160;
                    } else if (this.keysTwo.right){
                        this.player.body.vx = 160;
                    } else {
                        this.player.body.vx = 0;
                    }

                    if (this.keysTwo.x && this.player.jumpTimer < time && (this.player.body.blocked.bottom || this.player.body.touching.bottom)) {
                        this.player.body.vy = -320;
                        this.player.jumpTimer = time + 250;
                    }
                }
            }

            const game = new VerfGame({
                scenes: [{class: TestScene}],
                width: 320,
                height: 240,
                resizable: false,
                zoom: 2,
                background: '#495867',
                foreground: '#fcfff7'
            });
        </script>
    </body>
</html>
