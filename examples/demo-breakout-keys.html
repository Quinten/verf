<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Verf | Test</title>
        <meta name="description" content="">
        <meta name="author" content="Quinten Clause">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="../styles.css" />
    </head>
    <body>
        <script type="module">
            import {VerfGame, Scene, GameObject, Keys, World, Body} from '../index.js';

            class TestScene extends Scene {
                init ()
                {
                    let world = this.addWorld(new World());
                    world.setBounds(this.camera.x - this.viewport.width / 2, this.camera.y - this.viewport.height / 2, this.viewport.width, this.viewport.height);

                    let palette = this.add(new GameObject({x: this.viewport.width / 2, y: 32}));
                    palette.fillStyle = this.engine.foreground;
                    palette.width = 48;
                    palette.height = 8;
                    palette.addBody(new Body());
                    palette.body.restitution = 1;

                    this.palette = palette;

                    this.keys = this.addControls(new Keys());
                    // press r or y to restart
                    this.keys.on('yup', () => {
                        this.restart();
                    });

                    let ball = this.add(new GameObject({x: this.viewport.width / 2, y: 256}));
                    ball.fillStyle = this.engine.foreground;
                    ball.width = 8;
                    ball.height = 8;
                    ball.addBody(new Body());
                    ball.body.immovable = false;
                    ball.body.collideWorldBounds = true;
                    ball.body.vy = -0.2;
                    ball.body.vx = (-0.5 + Math.random()) * 0.1;

                    world.addCollider({
                        a: ball,
                        b: palette,
                        callback: () => {
                            ball.body.vx += this.palette.body.vx; // this allows the player to add an effect to the ball
                        }
                    });

                    for (let y = -1; y <= 1; y++) {
                        for (let x = -2; x <= 2; x++) {
                            let brick = this.add(new GameObject({x: this.viewport.width / 2 + x * 40, y: 360 + y * 16}));
                            brick.fillStyle = this.engine.foreground;
                            brick.width = 32;
                            brick.height = 8;
                            brick.addBody(new Body());
                            brick.body.restitution = 1;

                            world.addCollider({
                                a: ball,
                                b: brick,
                                callback: () => {
                                    this.remove(brick);
                                    this.camera.shake();
                                    this.camera.flash({color: this.engine.foreground, duration: 100 });
                                }
                            });
                        }
                    }
                }

                update(time, delta)
                {
                    if (this.keys.left) {
                        this.palette.body.vx = -0.1;
                    } else if (this.keys.right){
                        this.palette.body.vx = 0.1;
                    } else {
                        this.palette.body.vx = 0;
                    }
                }

                resize(w, h) {
                    if (this.world) {
                        this.world.setBounds(this.camera.x - w / 2, this.camera.y - h / 2, w, h);
                    }
                }
            }

            const game = new VerfGame({
                scenes: [{class: TestScene}],
                width: 320,
                height: 400,
                background: '#639fab',
                foreground: '#fcfff7'
            });
        </script>
    </body>
</html>
